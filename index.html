<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Entry Strike - ‰ªïË®≥Ê†ºÈóò„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            overflow: hidden;
            color: #fff;
            user-select: none;
        }

        .game-container {
            width: 100%;
            height: 100vh;
            position: relative;
            background: linear-gradient(180deg, #1a0a2e 0%, #0d1b2a 50%, #1b263b 100%);
            overflow: hidden;
        }

        /* „Éê„Éà„É´„Éï„Ç£„Éº„É´„ÉâËÉåÊôØ */
        .battlefield {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.5) 100%);
            border-top: 2px solid #415a77;
        }

        /* „Éò„ÉÉ„ÉÄ„ÉºUI */
        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
        }

        .player-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hp-bar-container {
            width: 120px;
            height: 16px;
            background: #333;
            border-radius: 8px;
            border: 2px solid #e63946;
            overflow: hidden;
        }

        .hp-bar {
            height: 100%;
            background: linear-gradient(90deg, #e63946 0%, #ff6b6b 100%);
            transition: width 0.3s ease;
        }

        .hp-text {
            font-size: 12px;
            color: #ff6b6b;
            font-weight: bold;
        }

        .stats {
            display: flex;
            gap: 15px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-label {
            font-size: 9px;
            color: #888;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd60a;
        }

        .combo-display {
            position: absolute;
            top: 60px;
            right: 15px;
            text-align: right;
        }

        .combo-count {
            font-size: 36px;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 0 0 20px #ff6b6b;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s ease;
        }

        .combo-count.active {
            opacity: 1;
            transform: scale(1);
        }

        .combo-label {
            font-size: 11px;
            color: #ffd60a;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* ÊïµÔºàÂèñÂºïÔºâ„ÅÆË°®Á§∫ */
        .enemy-area {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 400px;
            z-index: 50;
        }

        .enemy {
            padding: 15px;
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 12px;
            border: 3px solid #e63946;
            box-shadow: 0 0 30px rgba(230, 57, 70, 0.5);
            text-align: center;
        }

        .enemy.boss {
            border-color: #ffd60a;
            box-shadow: 0 0 40px rgba(255, 214, 10, 0.6);
            background: linear-gradient(135deg, #3d2d00 0%, #1a1500 100%);
        }

        .enemy.boss::before {
            content: "BOSS";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffd60a;
            color: #000;
            padding: 2px 12px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
        }

        .enemy-level {
            font-size: 10px;
            color: #888;
            margin-bottom: 5px;
        }

        .enemy-title {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .enemy-title-en {
            font-size: 11px;
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .enemy-hp-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
        }

        .enemy-hp {
            height: 100%;
            background: linear-gradient(90deg, #e63946 0%, #ff6b6b 100%);
            transition: width 0.3s ease;
        }

        /* „Çø„Ç§„Éû„Éº„Éê„Éº */
        .timer-bar {
            width: 100%;
            height: 4px;
            background: #222;
            margin-top: 10px;
            border-radius: 2px;
            overflow: hidden;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #e63946 0%, #ffd60a 50%, #4ecdc4 100%);
            transition: width 0.1s linear;
        }

        /* ÈÅ∏Êäû„Ç®„É™„Ç¢ */
        .selection-area {
            position: absolute;
            bottom: 110px;
            left: 0;
            right: 0;
            padding: 10px 15px;
        }

        .selection-row {
            margin-bottom: 12px;
        }

        .selection-label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .selection-label.debit {
            color: #4ecdc4;
        }

        .selection-label.credit {
            color: #ff6b6b;
        }

        .selected-display {
            font-size: 12px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            color: #fff;
        }

        .selected-display.empty {
            color: #666;
        }

        .choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .choice-btn {
            padding: 12px 8px;
            background: linear-gradient(135deg, #1a1a2e 0%, #0d1b2a 100%);
            border: 2px solid #415a77;
            border-radius: 8px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: center;
        }

        .choice-btn:active {
            transform: scale(0.95);
        }

        .choice-btn:hover {
            border-color: #4ecdc4;
            background: linear-gradient(135deg, #2a2a4e 0%, #1d2b4a 100%);
        }

        .choice-btn.selected {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.3);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }

        .choice-btn.correct {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.5);
            animation: correctPulse 0.5s ease;
        }

        .choice-btn.incorrect {
            border-color: #e63946;
            background: rgba(230, 57, 70, 0.5);
            animation: shake 0.3s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .choice-en {
            font-size: 11px;
            color: #4ecdc4;
            margin-bottom: 2px;
        }

        .choice-jp {
            font-size: 13px;
            color: #fff;
        }

        /* ÊîªÊíÉ„Éú„Çø„É≥ */
        .attack-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-top: 10px;
        }

        .attack-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }

        .attack-btn:not(:disabled):active {
            transform: scale(0.98);
        }

        /* „Ç®„Éï„Çß„ÇØ„Éà */
        .effect {
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            z-index: 200;
        }

        .effect.hit {
            color: #4ecdc4;
            text-shadow: 0 0 30px #4ecdc4;
        }

        .effect.miss {
            color: #e63946;
            text-shadow: 0 0 30px #e63946;
        }

        .effect.show {
            animation: effectPop 0.6s ease-out forwards;
        }

        @keyframes effectPop {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5) translateY(-30px); }
        }

        /* „Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-content {
            text-align: center;
            max-width: 400px;
            padding: 30px 20px;
            width: 95%;
        }

        .game-title {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #4ecdc4 0%, #ffd60a 50%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .game-subtitle {
            font-size: 16px;
            color: #778da9;
            margin-bottom: 25px;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: left;
            font-size: 13px;
            line-height: 1.9;
        }

        .instructions h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .start-btn {
            padding: 18px 50px;
            background: linear-gradient(135deg, #e63946 0%, #ff6b6b 100%);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        /* ÁµêÊûúÁîªÈù¢ */
        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .result-stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }

        .result-stat .label {
            font-size: 11px;
            color: #888;
        }

        .result-stat .value {
            font-size: 26px;
            font-weight: bold;
            color: #4ecdc4;
        }

        /* „Éó„É¨„Ç§„É§„Éº */
        .player-char {
            position: absolute;
            bottom: 105px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            z-index: 40;
            transition: transform 0.2s ease;
        }

        .player-char.attack {
            animation: playerAttack 0.3s ease;
        }

        .player-char.damage {
            animation: playerDamage 0.3s ease;
        }

        @keyframes playerAttack {
            0% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-30px) scale(1.3); }
            100% { transform: translateX(-50%) translateY(0); }
        }

        @keyframes playerDamage {
            0%, 100% { transform: translateX(-50%); filter: none; }
            25%, 75% { filter: brightness(3) hue-rotate(180deg); }
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-height: 700px) {
            .enemy-title {
                font-size: 16px;
            }

            .choice-btn {
                padding: 10px 6px;
            }

            .choice-en {
                font-size: 10px;
            }

            .choice-jp {
                font-size: 11px;
            }

            .selection-area {
                bottom: 100px;
            }
        }

        @media (max-height: 600px) {
            .combo-display {
                display: none;
            }

            .enemy-area {
                top: 60px;
            }

            .selection-area {
                bottom: 90px;
            }

            .battlefield {
                height: 80px;
            }

            .player-char {
                bottom: 85px;
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- „Çπ„Çø„Éº„ÉàÁîªÈù¢ -->
        <div class="overlay show" id="startOverlay">
            <div class="overlay-content">
                <h1 class="game-title">ENTRY STRIKE</h1>
                <p class="game-subtitle">‰ªïË®≥Ê†ºÈóò„Ç≤„Éº„É†</p>

                <div class="instructions">
                    <h3>ÈÅä„Å≥Êñπ</h3>
                    <p>‚öîÔ∏è ÂèñÂºïÂÜÖÂÆπ„ÇíË¶ã„Å¶Ê≠£„Åó„ÅÑ‰ªïË®≥„ÇíÈÅ∏„ÅπÔºÅ</p>
                    <p>üìò ÂÄüÊñπ(Dr)„Å®Ë≤∏Êñπ(Cr)„ÇíÈÅ∏Êäû„Åó„Å¶ATTACK</p>
                    <p>üî• „Ç≥„É≥„Éú„ÇíÁπã„ÅÑ„ÅßBOSS„ÇíÂÄí„ÅõÔºÅ</p>
                    <p>‚è±Ô∏è ÊôÇÈñìÂàá„Çå„Åß„ÉÄ„É°„Éº„Ç∏„ÇíÂèó„Åë„Çã</p>
                </div>

                <button class="start-btn" onclick="startGame()">FIGHT!</button>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÁîªÈù¢ -->
        <div class="overlay" id="gameOverOverlay">
            <div class="overlay-content">
                <h1 class="game-title" id="resultTitle">GAME OVER</h1>

                <div class="result-stats">
                    <div class="result-stat">
                        <div class="label">SCORE</div>
                        <div class="value" id="finalScore">0</div>
                    </div>
                    <div class="result-stat">
                        <div class="label">MAX COMBO</div>
                        <div class="value" id="finalCombo">0</div>
                    </div>
                    <div class="result-stat">
                        <div class="label">ENEMIES</div>
                        <div class="value" id="finalEnemies">0</div>
                    </div>
                    <div class="result-stat">
                        <div class="label">ACCURACY</div>
                        <div class="value" id="finalAccuracy">0%</div>
                    </div>
                </div>

                <button class="start-btn" onclick="startGame()">RETRY</button>
            </div>
        </div>

        <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
        <div class="game-header">
            <div class="player-status">
                <div class="hp-bar-container">
                    <div class="hp-bar" id="playerHp"></div>
                </div>
                <span class="hp-text">HP <span id="hpText">100</span></span>
            </div>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Lv</div>
                    <div class="stat-value" id="level">1</div>
                </div>
            </div>
        </div>

        <div class="combo-display">
            <div class="combo-count" id="comboCount">0</div>
            <div class="combo-label">COMBO</div>
        </div>

        <!-- ÊïµË°®Á§∫ -->
        <div class="enemy-area">
            <div class="enemy" id="enemy">
                <div class="enemy-level" id="enemyLevel">Lv.1</div>
                <div class="enemy-title" id="enemyTitle">ÂÇôÂìÅ„ÅÆË≥ºÂÖ•ÔºàÁèæÈáëÔºâ</div>
                <div class="enemy-title-en" id="enemyTitleEn">Purchase equipment with cash</div>
                <div class="enemy-hp-bar">
                    <div class="enemy-hp" id="enemyHp"></div>
                </div>
                <div class="timer-bar">
                    <div class="timer-fill" id="timerFill"></div>
                </div>
            </div>
        </div>

        <!-- „Éó„É¨„Ç§„É§„Éº -->
        <div class="player-char" id="player">‚öîÔ∏è</div>

        <!-- Âú∞Èù¢ -->
        <div class="battlefield"></div>

        <!-- ÈÅ∏Êäû„Ç®„É™„Ç¢ -->
        <div class="selection-area">
            <div class="selection-row">
                <div class="selection-label debit">
                    DrÔºàÂÄüÊñπÔºâ
                    <span class="selected-display empty" id="debitDisplay">Êú™ÈÅ∏Êäû</span>
                </div>
                <div class="choices" id="debitChoices"></div>
            </div>

            <div class="selection-row">
                <div class="selection-label credit">
                    CrÔºàË≤∏ÊñπÔºâ
                    <span class="selected-display empty" id="creditDisplay">Êú™ÈÅ∏Êäû</span>
                </div>
                <div class="choices" id="creditChoices"></div>
            </div>

            <button class="attack-btn" id="attackBtn" onclick="submitEntry()" disabled>
                ATTACK!
            </button>
        </div>

        <!-- „Ç®„Éï„Çß„ÇØ„Éà -->
        <div class="effect hit" id="hitEffect">HIT!</div>
        <div class="effect miss" id="missEffect">MISS</div>
    </div>

    <script>
        // ÂãòÂÆöÁßëÁõÆ„Éá„Éº„Çø
        const ACCOUNTS = {
            // Ë≥áÁî£
            cash: { en: 'Cash', jp: 'ÁèæÈáë' },
            accountsReceivable: { en: 'Accounts Receivable', jp: 'Â£≤ÊéõÈáë' },
            inventory: { en: 'Inventory', jp: 'Ê£öÂç∏Ë≥áÁî£' },
            supplies: { en: 'Supplies', jp: 'Ê∂àËÄóÂìÅ' },
            prepaidExpenses: { en: 'Prepaid Expenses', jp: 'ÂâçÊâïË≤ªÁî®' },
            equipment: { en: 'Equipment', jp: 'ÂÇôÂìÅ' },
            buildings: { en: 'Buildings', jp: 'Âª∫Áâ©' },
            land: { en: 'Land', jp: 'ÂúüÂú∞' },
            accumulatedDepreciation: { en: 'Accum. Depreciation', jp: 'Ê∏õ‰æ°ÂÑüÂç¥Á¥ØË®àÈ°ç' },
            rightOfUseAsset: { en: 'Right-of-Use Asset', jp: '‰ΩøÁî®Ê®©Ë≥áÁî£' },
            goodwill: { en: 'Goodwill', jp: '„ÅÆ„Çå„Çì' },
            investmentInSub: { en: 'Investment in Sub.', jp: 'Â≠ê‰ºöÁ§æÊ†™Âºè' },

            // Ë≤†ÂÇµ
            accountsPayable: { en: 'Accounts Payable', jp: 'Ë≤∑ÊéõÈáë' },
            notesPayable: { en: 'Notes Payable', jp: 'ÊîØÊâïÊâãÂΩ¢' },
            unearnedRevenue: { en: 'Unearned Revenue', jp: 'ÂâçÂèóÂèéÁõä' },
            accruedExpenses: { en: 'Accrued Expenses', jp: 'Êú™ÊâïË≤ªÁî®' },
            bondsPayable: { en: 'Bonds Payable', jp: 'Á§æÂÇµ' },
            leaseLiability: { en: 'Lease Liability', jp: '„É™„Éº„ÇπË≤†ÂÇµ' },

            // Á¥îË≥áÁî£
            commonStock: { en: 'Common Stock', jp: 'Ë≥áÊú¨Èáë' },
            retainedEarnings: { en: 'Retained Earnings', jp: 'Âà©ÁõäÂâ∞‰ΩôÈáë' },

            // ÂèéÁõä
            sales: { en: 'Sales', jp: 'Â£≤‰∏ä' },
            serviceRevenue: { en: 'Service Revenue', jp: 'ÂΩπÂãôÂèéÁõä' },
            interestIncome: { en: 'Interest Income', jp: 'ÂèóÂèñÂà©ÊÅØ' },

            // Ë≤ªÁî®
            costOfGoodsSold: { en: 'COGS', jp: 'Â£≤‰∏äÂéü‰æ°' },
            salariesExpense: { en: 'Salaries Expense', jp: 'Áµ¶‰∏é' },
            rentExpense: { en: 'Rent Expense', jp: 'ÊîØÊâïÂÆ∂Ë≥É' },
            depreciationExpense: { en: 'Depreciation Exp.', jp: 'Ê∏õ‰æ°ÂÑüÂç¥Ë≤ª' },
            suppliesExpense: { en: 'Supplies Expense', jp: 'Ê∂àËÄóÂìÅË≤ª' },
            interestExpense: { en: 'Interest Expense', jp: 'ÊîØÊâïÂà©ÊÅØ' },
            utilitiesExpense: { en: 'Utilities Expense', jp: 'Ê∞¥ÈÅìÂÖâÁÜ±Ë≤ª' }
        };

        // ÂèñÂºï„Éá„Éº„Çø
        const TRANSACTIONS = {
            easy: [
                {
                    title: 'ÂÇôÂìÅ„ÅÆË≥ºÂÖ•ÔºàÁèæÈáëÔºâ',
                    titleEn: 'Purchase equipment with cash',
                    debit: 'equipment',
                    credit: 'cash',
                    debitPool: ['equipment', 'supplies', 'inventory', 'buildings'],
                    creditPool: ['cash', 'accountsPayable', 'notesPayable', 'accruedExpenses']
                },
                {
                    title: 'Â£≤ÊéõÈáë„ÅÆÂõûÂèé',
                    titleEn: 'Collection of receivables',
                    debit: 'cash',
                    credit: 'accountsReceivable',
                    debitPool: ['cash', 'inventory', 'supplies', 'equipment'],
                    creditPool: ['accountsReceivable', 'sales', 'unearnedRevenue', 'cash']
                },
                {
                    title: 'Ê∂àËÄóÂìÅ„ÅÆË≥ºÂÖ•ÔºàÁèæÈáëÔºâ',
                    titleEn: 'Purchase supplies with cash',
                    debit: 'supplies',
                    credit: 'cash',
                    debitPool: ['supplies', 'inventory', 'equipment', 'prepaidExpenses'],
                    creditPool: ['cash', 'accountsPayable', 'notesPayable', 'accruedExpenses']
                },
                {
                    title: 'Ë≤∑ÊéõÈáë„ÅÆÊîØÊâï„ÅÑ',
                    titleEn: 'Payment of accounts payable',
                    debit: 'accountsPayable',
                    credit: 'cash',
                    debitPool: ['accountsPayable', 'notesPayable', 'accruedExpenses', 'unearnedRevenue'],
                    creditPool: ['cash', 'accountsReceivable', 'inventory', 'supplies']
                },
                {
                    title: 'ÁèæÈáëÂ£≤‰∏ä',
                    titleEn: 'Cash sales',
                    debit: 'cash',
                    credit: 'sales',
                    debitPool: ['cash', 'accountsReceivable', 'inventory', 'supplies'],
                    creditPool: ['sales', 'serviceRevenue', 'unearnedRevenue', 'interestIncome']
                }
            ],
            medium: [
                {
                    title: 'Ê∏õ‰æ°ÂÑüÂç¥„ÅÆË®à‰∏ä',
                    titleEn: 'Record depreciation expense',
                    debit: 'depreciationExpense',
                    credit: 'accumulatedDepreciation',
                    debitPool: ['depreciationExpense', 'suppliesExpense', 'rentExpense', 'salariesExpense'],
                    creditPool: ['accumulatedDepreciation', 'cash', 'accountsPayable', 'equipment']
                },
                {
                    title: 'Êéõ„ÅëÂ£≤‰∏ä',
                    titleEn: 'Sales on account',
                    debit: 'accountsReceivable',
                    credit: 'sales',
                    debitPool: ['accountsReceivable', 'cash', 'inventory', 'supplies'],
                    creditPool: ['sales', 'serviceRevenue', 'unearnedRevenue', 'accountsPayable']
                },
                {
                    title: 'Áµ¶‰∏é„ÅÆÊîØÊâï„ÅÑ',
                    titleEn: 'Payment of salaries',
                    debit: 'salariesExpense',
                    credit: 'cash',
                    debitPool: ['salariesExpense', 'rentExpense', 'utilitiesExpense', 'suppliesExpense'],
                    creditPool: ['cash', 'accruedExpenses', 'accountsPayable', 'notesPayable']
                },
                {
                    title: 'ÂâçÊâïË≤ªÁî®„ÅÆË®à‰∏ä',
                    titleEn: 'Record prepaid expenses',
                    debit: 'prepaidExpenses',
                    credit: 'cash',
                    debitPool: ['prepaidExpenses', 'supplies', 'inventory', 'equipment'],
                    creditPool: ['cash', 'accountsPayable', 'accruedExpenses', 'notesPayable']
                },
                {
                    title: 'Êú™ÊâïË≤ªÁî®„ÅÆË®à‰∏ä',
                    titleEn: 'Accrued expenses',
                    debit: 'utilitiesExpense',
                    credit: 'accruedExpenses',
                    debitPool: ['utilitiesExpense', 'salariesExpense', 'rentExpense', 'interestExpense'],
                    creditPool: ['accruedExpenses', 'cash', 'accountsPayable', 'notesPayable']
                },
                {
                    title: 'Ê∂àËÄóÂìÅ„ÅÆË≤ªÁî®Âåñ',
                    titleEn: 'Supplies used',
                    debit: 'suppliesExpense',
                    credit: 'supplies',
                    debitPool: ['suppliesExpense', 'depreciationExpense', 'utilitiesExpense', 'rentExpense'],
                    creditPool: ['supplies', 'cash', 'inventory', 'prepaidExpenses']
                }
            ],
            hard: [
                {
                    title: 'Á§æÂÇµ„ÅÆÁô∫Ë°åÔºàÈ°çÈù¢Ôºâ',
                    titleEn: 'Issue bonds at par',
                    debit: 'cash',
                    credit: 'bondsPayable',
                    debitPool: ['cash', 'accountsReceivable', 'equipment', 'buildings'],
                    creditPool: ['bondsPayable', 'commonStock', 'notesPayable', 'leaseLiability']
                },
                {
                    title: 'ÂâçÂèóÂèéÁõä„ÅÆÂèéÁõäÂåñ',
                    titleEn: 'Recognize earned revenue',
                    debit: 'unearnedRevenue',
                    credit: 'serviceRevenue',
                    debitPool: ['unearnedRevenue', 'accountsPayable', 'accruedExpenses', 'notesPayable'],
                    creditPool: ['serviceRevenue', 'sales', 'interestIncome', 'cash']
                },
                {
                    title: 'ÊîØÊâïÂà©ÊÅØ„ÅÆÊú™ÊâïË®à‰∏ä',
                    titleEn: 'Accrue interest expense',
                    debit: 'interestExpense',
                    credit: 'accruedExpenses',
                    debitPool: ['interestExpense', 'rentExpense', 'salariesExpense', 'depreciationExpense'],
                    creditPool: ['accruedExpenses', 'cash', 'bondsPayable', 'notesPayable']
                }
            ],
            boss: [
                {
                    title: '„ÄêBOSS„Äë„É™„Éº„ÇπË≥áÁî£„ÅÆË®à‰∏ä',
                    titleEn: 'Recognize lease (IFRS16)',
                    debit: 'rightOfUseAsset',
                    credit: 'leaseLiability',
                    debitPool: ['rightOfUseAsset', 'equipment', 'buildings', 'goodwill'],
                    creditPool: ['leaseLiability', 'bondsPayable', 'cash', 'accountsPayable'],
                    isBoss: true
                },
                {
                    title: '„ÄêBOSS„Äë„ÅÆ„Çå„Çì„ÅÆË®à‰∏ä',
                    titleEn: 'Record goodwill from acquisition',
                    debit: 'goodwill',
                    credit: 'cash',
                    debitPool: ['goodwill', 'rightOfUseAsset', 'investmentInSub', 'buildings'],
                    creditPool: ['cash', 'bondsPayable', 'commonStock', 'accountsPayable'],
                    isBoss: true
                },
                {
                    title: '„ÄêBOSS„ÄëÈÄ£ÁµêÊ∂àÂéªÔºöÊäïË≥á„Å®Ë≥áÊú¨',
                    titleEn: 'Eliminate investment vs equity',
                    debit: 'commonStock',
                    credit: 'investmentInSub',
                    debitPool: ['commonStock', 'retainedEarnings', 'goodwill', 'rightOfUseAsset'],
                    creditPool: ['investmentInSub', 'cash', 'bondsPayable', 'leaseLiability'],
                    isBoss: true
                }
            ]
        };

        // „Ç≤„Éº„É†Áä∂ÊÖã
        let gameState = {
            hp: 100,
            score: 0,
            level: 1,
            combo: 0,
            maxCombo: 0,
            enemiesDefeated: 0,
            totalAttempts: 0,
            correctAttempts: 0,
            currentTransaction: null,
            selectedDebit: null,
            selectedCredit: null,
            timeLeft: 100,
            maxTime: 100,
            timerInterval: null,
            isRunning: false
        };

        // DOMË¶ÅÁ¥†
        const elements = {
            playerHp: document.getElementById('playerHp'),
            hpText: document.getElementById('hpText'),
            score: document.getElementById('score'),
            level: document.getElementById('level'),
            comboCount: document.getElementById('comboCount'),
            enemy: document.getElementById('enemy'),
            enemyLevel: document.getElementById('enemyLevel'),
            enemyTitle: document.getElementById('enemyTitle'),
            enemyTitleEn: document.getElementById('enemyTitleEn'),
            enemyHp: document.getElementById('enemyHp'),
            timerFill: document.getElementById('timerFill'),
            debitChoices: document.getElementById('debitChoices'),
            creditChoices: document.getElementById('creditChoices'),
            debitDisplay: document.getElementById('debitDisplay'),
            creditDisplay: document.getElementById('creditDisplay'),
            attackBtn: document.getElementById('attackBtn'),
            player: document.getElementById('player'),
            hitEffect: document.getElementById('hitEffect'),
            missEffect: document.getElementById('missEffect'),
            startOverlay: document.getElementById('startOverlay'),
            gameOverOverlay: document.getElementById('gameOverOverlay')
        };

        // ÈÖçÂàó„Çí„Ç∑„É£„ÉÉ„Éï„É´
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // ÈÅ∏ÊäûËÇ¢„Éú„Çø„É≥„ÇíÁîüÊàê
        function createChoiceButton(accountKey, type) {
            const account = ACCOUNTS[accountKey];
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerHTML = `
                <div class="choice-en">${account.en}</div>
                <div class="choice-jp">${account.jp}</div>
            `;
            btn.dataset.account = accountKey;
            btn.onclick = () => selectChoice(accountKey, type);
            return btn;
        }

        // ÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏Êäû
        function selectChoice(accountKey, type) {
            if (!gameState.isRunning) return;

            const account = ACCOUNTS[accountKey];
            const container = type === 'debit' ? elements.debitChoices : elements.creditChoices;
            const display = type === 'debit' ? elements.debitDisplay : elements.creditDisplay;

            // Ââç„ÅÆÈÅ∏Êäû„Çí„ÇØ„É™„Ç¢
            container.querySelectorAll('.choice-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Êñ∞„Åó„ÅÑÈÅ∏Êäû„Çí„Éû„Éº„ÇØ
            const selectedBtn = container.querySelector(`[data-account="${accountKey}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }

            // Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            if (type === 'debit') {
                gameState.selectedDebit = accountKey;
            } else {
                gameState.selectedCredit = accountKey;
            }

            // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            display.textContent = account.jp;
            display.classList.remove('empty');

            // ÊîªÊíÉ„Éú„Çø„É≥„ÅÆÊúâÂäπÂåñ„ÉÅ„Çß„ÉÉ„ÇØ
            updateAttackButton();
        }

        // ÊîªÊíÉ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
        function updateAttackButton() {
            const canAttack = gameState.selectedDebit && gameState.selectedCredit;
            elements.attackBtn.disabled = !canAttack;
        }

        // ÂèñÂºï„ÇíÁîüÊàê
        function spawnTransaction() {
            let pool;

            if (gameState.combo >= 10 || gameState.level >= 5) {
                pool = [...TRANSACTIONS.hard, ...TRANSACTIONS.boss];
            } else if (gameState.combo >= 5 || gameState.level >= 3) {
                pool = [...TRANSACTIONS.medium, ...TRANSACTIONS.hard];
            } else if (gameState.level >= 2) {
                pool = [...TRANSACTIONS.easy, ...TRANSACTIONS.medium];
            } else {
                pool = TRANSACTIONS.easy;
            }

            const transaction = pool[Math.floor(Math.random() * pool.length)];
            gameState.currentTransaction = transaction;
            gameState.selectedDebit = null;
            gameState.selectedCredit = null;

            // Êïµ„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            elements.enemyLevel.textContent = `Lv.${gameState.level}`;
            elements.enemyTitle.textContent = transaction.title;
            elements.enemyTitleEn.textContent = transaction.titleEn;
            elements.enemyHp.style.width = '100%';

            if (transaction.isBoss) {
                elements.enemy.classList.add('boss');
                gameState.maxTime = 120;
            } else {
                elements.enemy.classList.remove('boss');
                gameState.maxTime = Math.max(50, 100 - gameState.level * 8);
            }

            gameState.timeLeft = gameState.maxTime;
            elements.timerFill.style.width = '100%';

            // ÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàêÔºàÊ≠£Ëß£„ÇíÂê´„ÇÅ„Å¶„Ç∑„É£„ÉÉ„Éï„É´Ôºâ
            const debitChoices = shuffle(transaction.debitPool);
            const creditChoices = shuffle(transaction.creditPool);

            elements.debitChoices.innerHTML = '';
            elements.creditChoices.innerHTML = '';

            debitChoices.forEach(key => {
                elements.debitChoices.appendChild(createChoiceButton(key, 'debit'));
            });

            creditChoices.forEach(key => {
                elements.creditChoices.appendChild(createChoiceButton(key, 'credit'));
            });

            // Ë°®Á§∫„Çí„É™„Çª„ÉÉ„Éà
            elements.debitDisplay.textContent = 'Êú™ÈÅ∏Êäû';
            elements.debitDisplay.classList.add('empty');
            elements.creditDisplay.textContent = 'Êú™ÈÅ∏Êäû';
            elements.creditDisplay.classList.add('empty');
            elements.attackBtn.disabled = true;
        }

        // ÂõûÁ≠î„ÇíÈÄÅ‰ø°
        function submitEntry() {
            if (!gameState.isRunning || !gameState.currentTransaction) return;
            if (!gameState.selectedDebit || !gameState.selectedCredit) return;

            const transaction = gameState.currentTransaction;
            gameState.totalAttempts++;

            const debitCorrect = gameState.selectedDebit === transaction.debit;
            const creditCorrect = gameState.selectedCredit === transaction.credit;

            // „Éú„Çø„É≥„ÅÆËâ≤„ÇíÂ§âÊõ¥
            elements.debitChoices.querySelectorAll('.choice-btn').forEach(btn => {
                if (btn.dataset.account === transaction.debit) {
                    btn.classList.add('correct');
                } else if (btn.classList.contains('selected')) {
                    btn.classList.add('incorrect');
                }
            });

            elements.creditChoices.querySelectorAll('.choice-btn').forEach(btn => {
                if (btn.dataset.account === transaction.credit) {
                    btn.classList.add('correct');
                } else if (btn.classList.contains('selected')) {
                    btn.classList.add('incorrect');
                }
            });

            if (debitCorrect && creditCorrect) {
                // Ê≠£Ëß£ÔºÅ
                gameState.correctAttempts++;
                gameState.combo++;
                if (gameState.combo > gameState.maxCombo) {
                    gameState.maxCombo = gameState.combo;
                }

                const baseScore = transaction.isBoss ? 500 : 100;
                const comboBonus = Math.floor(gameState.combo * 15);
                const timeBonus = Math.floor(gameState.timeLeft / 5);
                const totalScore = baseScore + comboBonus + timeBonus;
                gameState.score += totalScore;

                gameState.enemiesDefeated++;

                if (gameState.enemiesDefeated % 5 === 0) {
                    gameState.level++;
                    elements.level.textContent = gameState.level;
                }

                updateUI();
                showEffect('hit', `+${totalScore}`);
                elements.player.classList.add('attack');
                setTimeout(() => elements.player.classList.remove('attack'), 300);

                setTimeout(spawnTransaction, 800);
            } else {
                // ‰∏çÊ≠£Ëß£
                gameState.combo = 0;
                takeDamage(15);
                showEffect('miss', 'MISS');
                updateUI();

                setTimeout(spawnTransaction, 1000);
            }
        }

        // „ÉÄ„É°„Éº„Ç∏„ÇíÂèó„Åë„Çã
        function takeDamage(amount) {
            gameState.hp = Math.max(0, gameState.hp - amount);
            elements.player.classList.add('damage');
            setTimeout(() => elements.player.classList.remove('damage'), 300);

            if (gameState.hp <= 0) {
                gameOver();
            }
        }

        // „Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
        function showEffect(type, text) {
            const effect = type === 'hit' ? elements.hitEffect : elements.missEffect;
            effect.textContent = text;
            effect.classList.add('show');
            setTimeout(() => effect.classList.remove('show'), 600);
        }

        // UIÊõ¥Êñ∞
        function updateUI() {
            elements.playerHp.style.width = gameState.hp + '%';
            elements.hpText.textContent = gameState.hp;
            elements.score.textContent = gameState.score;

            elements.comboCount.textContent = gameState.combo;
            if (gameState.combo > 0) {
                elements.comboCount.classList.add('active');
            } else {
                elements.comboCount.classList.remove('active');
            }
        }

        // „Çø„Ç§„Éû„Éº
        function startTimer() {
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft -= 1;
                elements.timerFill.style.width = (gameState.timeLeft / gameState.maxTime * 100) + '%';

                if (gameState.timeLeft <= 0) {
                    gameState.combo = 0;
                    takeDamage(20);
                    showEffect('miss', 'TIME UP');
                    updateUI();

                    if (gameState.hp > 0) {
                        spawnTransaction();
                    }
                }
            }, 100);
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        function startGame() {
            gameState = {
                hp: 100,
                score: 0,
                level: 1,
                combo: 0,
                maxCombo: 0,
                enemiesDefeated: 0,
                totalAttempts: 0,
                correctAttempts: 0,
                currentTransaction: null,
                selectedDebit: null,
                selectedCredit: null,
                timeLeft: 100,
                maxTime: 100,
                timerInterval: null,
                isRunning: true
            };

            elements.startOverlay.classList.remove('show');
            elements.gameOverOverlay.classList.remove('show');

            updateUI();
            elements.level.textContent = '1';

            spawnTransaction();
            startTimer();
        }

        // „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº
        function gameOver() {
            gameState.isRunning = false;
            clearInterval(gameState.timerInterval);

            const accuracy = gameState.totalAttempts > 0
                ? Math.round(gameState.correctAttempts / gameState.totalAttempts * 100)
                : 0;

            document.getElementById('resultTitle').textContent =
                gameState.enemiesDefeated >= 15 ? 'VICTORY!' : 'GAME OVER';
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalCombo').textContent = gameState.maxCombo;
            document.getElementById('finalEnemies').textContent = gameState.enemiesDefeated;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';

            elements.gameOverOverlay.classList.add('show');
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
        document.addEventListener('keydown', (e) => {
            if (!gameState.isRunning) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    startGame();
                }
                return;
            }

            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                submitEntry();
            }
        });
    </script>
</body>
</html>
